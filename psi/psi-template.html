
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="icon" href="https://developers.google.com/favicon.ico">
  <title>Lightsights Report</title>
  <link rel=stylesheet href="../lighthouse-core/report/html/report-styles.css">
</head>
<body>

  <header>
    <nav>
      <img src="images/header.png">
    </nav>
    <div id="searchbar">
      <img src="images/searchbar.png">
    </div>
  </header>

  <div class="report-ss-columns">
    <main class="lh-report-root lh-root lh-vars"><!-- report populated here --></main>
    <div class="ss-column">
      <img src="images/screenshot.jpg">
    </div>
  </div>

  <!-- we need all these files present in the page's global scope -->
  <script src="../lighthouse-core/report/html/renderer/util.js"></script>
  <script src="../lighthouse-core/report/html/renderer/dom.js"></script>
  <script src="../lighthouse-core/report/html/renderer/details-renderer.js"></script>
  <script src="../lighthouse-core/report/html/renderer/crc-details-renderer.js"></script>
  <script src="../lighthouse-core/report/html/renderer/category-renderer.js"></script>
  <script src="../lighthouse-core/report/html/renderer/performance-category-renderer.js"></script>
  <script src="../lighthouse-core/report/html/renderer/report-renderer.js"></script>

  <div hidden id="all-templates"></div>
  <iframe hidden id="templateframe" src="../lighthouse-core/report/html/templates.html"></iframe>

  <!-- PSI Modifications -->
  <link rel=stylesheet href="./psi-styles.css">
  <!-- example of psi's own code -->
  <script src="./psi-ui.js"></script>

  <script>
    const iframe = document.querySelector('#templateframe');
    let dom;
    iframe.addEventListener('load', async _ => {

      // Hack to expose HTML templates within this DOM
      // In a real deployment, the templates.html file would be emitted into the HTML of this page
      document.querySelector('#all-templates').appendChild(iframe.contentWindow.document.documentElement);

      // Hack to use a convenient LHR
      // Exposing this as __LIGHTHOUSE_JSON__ isn't neccessary, but just useful for debugging
      window.__LIGHTHOUSE_JSON__ = await fetch('../lighthouse-core/test/results/sample_v2.json').then(r => r.json());

      // Prepare the Lighthouse response for the renderer.
      // (This bit is usually done within ReportRenderer)
      const reportLHR = JSON.parse(JSON.stringify(__LIGHTHOUSE_JSON__));
      reportLHR.reportCategories = Object.values(reportLHR.categories);
      ReportRenderer.smooshAuditResultsIntoCategories(reportLHR.audits, reportLHR.reportCategories);

      dom = new DOM(document);

      // Render ONLY the perf category into a fresh element
      const perfCategory = reportLHR.reportCategories.find(cat => cat.id === 'performance');
      const perfRenderer = new PerformanceCategoryRenderer(dom, new DetailsRenderer(dom));
      const perfElem = perfRenderer.render(perfCategory, reportLHR.categoryGroups);

      // Example edit to the perf category: Remove the jump link on its score gauge
      dom.find('.lh-gauge__wrapper', perfElem).removeAttribute('href')

      // Create a fresh score gauge
      const bigScoreGauge = perfRenderer.renderScoreGauge(perfCategory);
      bigScoreGauge.firstElementChild.classList.add('lh-gauge__wrapper--huge');

      // Add these elements to the page: big score gauge, field data, then perf category
      const container = document.querySelector('.lh-report-root');
      container.appendChild(bigScoreGauge);
      container.appendChild(renderFieldDataSection());
      container.appendChild(perfElem);
    });
  </script>
</body>
</html>
